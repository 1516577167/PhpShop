<!DOCTYPE html>
<html><head>
 <meta charset="utf-8">
 <title>å—¨è´­ç½‘ä¸Šè´­ç‰©å•†åŸ</title>

 <meta name="description" content="Dashboard">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <!--Basic Styles-->
 <link href="__admin__/style/bootstrap.css" rel="stylesheet">
 <link href="__admin__/style/font-awesome.css" rel="stylesheet">
 <link href="__admin__/style/weather-icons.css" rel="stylesheet">

 <!--Beyond styles-->
 <link id="beyond-link" href="__admin__/style/beyond.css" rel="stylesheet" type="text/css">
 <link href="__admin__/style/demo.css" rel="stylesheet">
 <link href="__admin__/style/typicons.css" rel="stylesheet">
 <link href="__admin__/style/animate.css" rel="stylesheet">
   <script src="__plus__/ueditor/ueditor.config.js"></script>
   <script src="__plus__/ueditor/ueditor.all.min.js"></script>
   <script src="__plus__/ueditor/lang/zh-cn/zh-cn.js"></script>
   <style type="text/css">
   .price{
    width: 150px;margin;
    display:inline-block;
    margin-left: 10px;
   }  
   .abtn{
    padding-right: 10px;
   }
   </style>
   

</head>
<body>
  <!-- å¤´éƒ¨ -->
  {include file="common/top" /}
  <!-- /å¤´éƒ¨ -->

  <div class="main-container container-fluid">
    <div class="page-container">
     <!-- Page Sidebar -->
     {include file="common/left" /}
     <!-- /Page Sidebar -->
     <!-- Page Content -->
     <div class="page-content">
      <!-- Page Breadcrumb -->
      <div class="page-breadcrumbs">
        <ul class="breadcrumb">
          <li>
            <a href="{:url('Index/index')}">ç³»ç»Ÿ</a>
          </li>
          <li>
            <a href="{:url('Goods/lst')}">å•†å“ç®¡ç†</a>
          </li>
          <li class="active">ä¿®æ”¹å•†å“</li>
        </ul>
      </div>
      <!-- /Page Breadcrumb -->

      <!-- Page Body -->
      <div class="page-body">
        <div class="row">
          <div class="col-lg-12 col-sm-12 col-xs-12">
            <div class="widget">
              <form class="form-horizontal" action="" method="post" enctype="multipart/form-data">
                <input type="hidden" name="id" value="{$goods.id}">
                <input type="hidden" name="og_thumb" value="{$goods.og_thumb}">
                <input type="hidden" name="big_thumb" value="{$goods.big_thumb}">
                <input type="hidden" name="mid_thumb" value="{$goods.mid_thumb}">
                <input type="hidden" name="sm_thumb" value="{$goods.sm_thumb}">
                <!-- å•†å“ä¿¡æ¯å¼€å§‹ -->
                <div class="widget-body">
                  <div class="widget-main ">
                    <div class="tabbable">
                      <ul class="nav nav-tabs tabs-flat" id="myTab11">
                        <li class="active">
                          <a data-toggle="tab" href="#baseinfo">
                            å•†å“åŸºæœ¬ä¿¡æ¯
                          </a>
                        </li>
                        <li class="">
                          <a data-toggle="tab" href="#goodsdes">
                            è¯¦æƒ…æè¿°
                          </a>
                        </li>
                       <li class="">
                          <a data-toggle="tab" href="#mbprice">
                            ä¼šå‘˜ä»·æ ¼
                          </a>
                        </li>
                         <li class="">
                          <a data-toggle="tab" href="#goodsattr">
                            å•†å“å±æ€§
                          </a>
                        </li>
                        <li class="">
                          <a data-toggle="tab" href="#goodsphoto">
                            å•†å“ç›¸å†Œ
                          </a>
                        </li>
                      </ul>
                      <div class="tab-content tabs-flat">
                        <div id="baseinfo" class="tab-pane in active">
                          <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">å•†å“åç§°</label>
                            <div class="col-sm-6">
                              <input class="form-control" name="goods_name" value="{$goods.goods_name}" type="text">
                            </div>
                            <p class="help-block col-sm-4 red">* å¿…å¡«</p>
                          </div>

                           <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">æ¨èä½</label>
                            <div class="col-sm-6">
                              <div class="checkbox">
                                {volist name="goodsRecposRes" id="recpos"}
                                <label style="margin-right:15px">
                                  <?php
                                  if(in_array($recpos['id'],$myGoodsRecposRes)){
                                  $checked='checked="checked"';
                                  }else{
                                  $checked="";
                                  }
                                  ?>
                                  <input <?php echo $checked; ?> type="checkbox" name="recpos[]" value="{$recpos.id}" class="colored-blue">
                                  <span class="text">{$recpos.rec_name}</span>
                                </label>
                                {/volist}
                              </div>
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">å•†å“ä¸»å›¾</label>
                            <div class="col-sm-6">
                              <input class="form-control" style="border: none;box-shadow:none;" name="og_thumb" type="file">
                              {if condition="$goods.sm_thumb"}
                              <img src="__uploads__/{$goods.sm_thumb}" alt="" height="30px">
                              {else /}
                              æš‚æ— ç¼©ç•¥å›¾
                              {/if}
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">ä¸Šæ¶</label>
                            <div class="col-sm-6">
                              <div class="radio">
                                <label>
                                  <input {if condition="$goods.on_sale eq 1"} checked="checked" {/if} name="on_sale" type="radio" class="colored-blue" value="1">
                                  <span class="text"> æ˜¯</span>
                                </label>
                                <label>
                                  <input {if condition="$goods.on_sale eq 0"} checked="checked" {/if} name="on_sale" type="radio" class="colored-blue" value="0">
                                  <span class="text"> å¦</span>
                                </label>
                              </div>
                            </div>
                          </div>
                        
                        <div class="form-group">
                          <label for="username" class="col-sm-2 control-label no-padding-right">æ‰€å±æ ç›®</label>
                          <div class="col-sm-6">
                            <select name="category_id">
                              <option value="">è¯·é€‰æ‹©</option>
                                  {volist name="categoryRes" id="cate"}
                                  <option {if condition="$goods.category_id eq $cate.id"}selected="selected"{/if} value="{$cate.id}"><?php echo str_repeat('-',$cate['level']*4); ?>{$cate.cate_name}</option>
                                  {/volist}
                            </select>
                          </div>
                        </div>

                        <div class="form-group">
                          <label for="username" class="col-sm-2 control-label no-padding-right">æ‰€å±å“ç‰Œ</label>
                          <div class="col-sm-6">
                            <select name="brand_id">
                              <option value="">è¯·é€‰æ‹©</option>
                              {volist name="brandRes" id="brand"}
                              <option {if condition="$goods.brand_id eq $brand.id"}selected="selected"{/if} value="{$brand.id}">{$brand.brand_name}</option>
                              {/volist}
                            </select>
                          </div>
                        </div>

                        <div class="form-group">
                          <label for="username" class="col-sm-2 control-label no-padding-right">å¸‚åœºä»·</label>
                          <div class="col-sm-6">
                            <input class="form-control" name="markte_price" value="{$goods.markte_price}" type="text">
                          </div>
                          <p class="help-block col-sm-4 red">* å¿…å¡«</p>
                        </div>

                          <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">æœ¬åº—ä»·</label>
                            <div class="col-sm-6">
                              <input class="form-control" name="shop_price" value="{$goods.shop_price}" type="text">
                            </div>
                            <p class="help-block col-sm-4 red">* å¿…å¡«</p>
                          </div>

                          <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">é‡é‡</label>
                            <div class="col-sm-6">
                              <input class="form-control" style="width: 100px;display: inline-block;" name="goods_weight" value="{$goods.goods_weight}" type="text">
                              <select name="weight_unit">
                              <option {if condition="$goods.weight_unit eq 'kg'"}selected="selected"{/if} value="kg">kg</option>
                              <option {if condition="$goods.weight_unit eq 'g'"}selected="selected"{/if} value="g">g</option>
                            </select>
              
                            </div>
                            <p class="help-block col-sm-4 red">* å¿…å¡«</p>
                          </div>
                          </div>

                        <div id="goodsdes" class="tab-pane">
                          <textarea name="goods_des" id="goods_des">{$goods.goods_des}</textarea>
                        </div>
                       <div id="mbprice" class="tab-pane">
                        {volist name="mls" id="ml"}
                        <?php
                        $price='';
                         foreach($mpRes as $k=>$v){
                         if($v['mlevel_id']==$ml['id']){
                         $price=$v['mprice'];
                       break;
                       }
                       } ?>
                          <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right">{$ml.level_name}</label>
                            <div class="col-sm-6">
                              <input class="form-control" name="mp[{$ml.id}]" type="text" value="{$price}">
                            </div>
                          </div>
                        {/volist}
                        </div>
                         
                        <div id="goodsattr" class="tab-pane">
                          
                          <div class="form-group">
                          <label for="username" class="col-sm-2 control-label no-padding-right">å•†å“ç±»å‹</label>
                          <div class="col-sm-6">
                            <select name="type_id" {if condition="$goods.type_id neq 0"}disabled="disabled"{/if}>
                               <option value="0">è¯·é€‰æ‹©</option>
                              {volist name="typeRes" id="type"}
                              <option {if condition="$goods.type_id eq $type.id"}selected="selected"{/if} value="{$type.id}">{$type.type_name}</option>
                              {/volist}
                            </select>
                          </div>
                        </div>

                        <div id="attr_list">
                         <!-- å±æ€§æ˜¾ç¤º -->
                         <?php foreach($attrRes as $k=>$v): ?>
                            <?php if($v['attr_type'] == 1):
                                $arrRadio=explode(',',$v['attr_values']);
                             ?>
                            <!-- å•é€‰ -->
                            <!-- å¾ªç¯æ˜¾ç¤ºå½“å‰å•†å“æ‰€æ‹¥æœ‰çš„æ‰€æœ‰å•é€‰å±æ€§ -->
                            <?php foreach($gattrRes[$v['id']] as $k0=>$v0): ?>

                            <div gaid="<?php echo $v0['id']; ?>" class="form-group"><label class="col-sm-2 control-label no-padding-right"><?php echo $v['attr_name']; ?></label><div class="col-sm-6"><a class="abtn" href="#" onclick="addrow(this);"><?php if($k0==0){ echo '[+]';}else{ echo '[-]';} ?></a>
                                <select name='old_goods_attr[<?php echo $v['id']; ?>][]'>
                                  <option value="">è¯·é€‰æ‹©</option>
                                      <?php foreach($arrRadio as $k1=>$v1): ?>
                                      <option <?php if($v1==$v0['attr_value']){ echo 'selected="selected"';} ?> value="<?php echo $v1; ?>"><?php echo $v1; ?></option>
                                      <?php endforeach; ?>
                                </select>
                                <input type="text" class="form-control price" placeholder="ä»·æ ¼" name="old_attr_price[<?php echo $v0['id']; ?>]" value="<?php echo $v0['attr_price']; ?>"></div></div>
                                <?php endforeach; ?>
                            <?php else: ?>
                            <!-- å”¯ä¸€ -->
                                <?php if(!$v['attr_values']): ?>
                                    <div class="form-group"><label class="col-sm-2 control-label no-padding-right"><?php echo $v['attr_name']; ?></label><div class="col-sm-6"><input type="text" class="form-control price" name='old_goods_attr[<?php echo $v['id']; ?>]' value="<?php echo $gattrRes[$v['id']][0]['attr_value']; ?>"><input type="hidden" name="old_attr_price[<?php echo $gattrRes[$v['id']][0]['id']; ?>]"></div></div>
                                <?php else:
                                $arrSelect=explode(',',$v['attr_values']);
                                ?>
                                <div class="form-group"><label class="col-sm-2 control-label no-padding-right"><?php echo $v['attr_name']; ?></label><div class="col-sm-6">
                                <select name='old_goods_attr[<?php echo $v['id']; ?>]'>
                                  <option value="">è¯·é€‰æ‹©</option>
                                  <?php foreach($arrSelect as $k1=>$v1): ?>
                                      <option <?php if($v1==$gattrRes[$v['id']][0]['attr_value']){ echo 'selected="selected"';} ?> value="<?php echo $v1; ?>"><?php echo $v1; ?></option>
                                      <?php endforeach; ?>
                                </select>
                                <input type="hidden" name="old_attr_price[<?php echo $gattrRes[$v['id']][0]['id']; ?>]">
                                </div></div>
                                <?php endif; ?>
                            <?php endif; ?>
                         <?php endforeach; ?>
                      </div>

                    </div>

                        <div id="goodsphoto" class="tab-pane">

                          {volist name="gphotoRes" id="gphoto"}
                          <div id="{$gphoto.id}" class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right"></label>
                            <div class="col-sm-6">
                              <a href="#" onclick="delrow(this);">[-]</a>
                              <img style="box-shadow:none;display:inline-block;" src="__uploads__/{$gphoto.sm_photo}" alt="" height="50">
                            </div>
                          </div>
                          {/volist}

                           <div class="form-group">
                            <label for="username" class="col-sm-2 control-label no-padding-right"></label>
                            <div class="col-sm-6">
                              <a href="#" onclick="addphoto(this);">[+]</a><input class="form-control" style="border: none;box-shadow:none; width:50%;display:inline-block;" name="goods_photo[]"  type="file">
                            </div>
                          </div>

                          <div id="goods_photo">
                            
                          </div>

                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-default">ä¿å­˜ä¿¡æ¯</button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- å•†å“ä¿¡æ¯ç»“æŸ -->
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- /Page Body -->
    </div>
    <!-- /Page Content -->
  </div>  
</div>

<!--Basic Scripts-->
<script src="__admin__/style/jquery_002.js"></script>
<script src="__admin__/style/bootstrap.js"></script>
<script src="__admin__/style/jquery.js"></script>
<!--Beyond Scripts-->
<script src="__admin__/style/beyond.js"></script>
<script type="text/javascript">
    // å®ä¾‹åŒ–ç¼–è¾‘å™¨
    UE.getEditor('goods_des',{initialFrameWidth:1040,initialFrameHeight:700,toolbars: [['fullscreen', 'source', 'undo', 'redo'],['bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript','removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist','selectall', 'cleardoc']]})
</script>
<script type="text/javascript">
  $("select[name=type_id]").change(function() {
    var type_id=$(this).val();
    $.ajax({
      type:"POST",
      url:"{:url('Attr/ajaxGetAttr')}",
      data:{type_id:type_id},
      dataType:"json",
      success:function(data){
        // console.log(data);
        var html='';
        $(data).each(function(k,v){
          if(v.attr_type == 1){
            //å•é€‰å¤„ç†
            html+="<div class='form-group'>";
            html+="<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
            var attrValuesArr=v.attr_values.split(",");
            html+="<div class='col-sm-6'><a class='abtn' href='#' onclick='addrow(this);'>[+]</a>";
            html+="<select name='goods_attr["+v.id+"][]'>";
            html+="<option value=''>è¯·é€‰æ‹©</option>";
            for(var i=0;i<attrValuesArr.length;i++){
              html+="<option value='"+attrValuesArr[i]+"'>"+attrValuesArr[i]+"</option>";
            }
            html+="</select>";
            html+="<input type='text' class='form-control price' placeholder='ä»·æ ¼' name='attr_price[]'>";
            html+="</div>";
            html+="</div>";
          }else{
            //å”¯ä¸€å¤„ç†
            if(v.attr_values){
             html+="<div class='form-group'>";
            html+="<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
            var attrValuesArr=v.attr_values.split(",");
            html+="<div class='col-sm-6'>";
            html+="<select name='goods_attr["+v.id+"]'>";
            html+="<option value=''>è¯·é€‰æ‹©</option>";
            for(var i=0;i<attrValuesArr.length;i++){
              html+="<option value='"+attrValuesArr[i]+"'>"+attrValuesArr[i]+"</option>";
            }
            html+="</select>";
            html+="</div>";
            html+="</div>";
            }else{
              html+="<div class='form-group'>";
            html+="<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
            var attrValuesArr=v.attr_values.split(",");
            html+="<div class='col-sm-6'>";
            html+="<input type='text' class='form-control price' name='goods_attr["+v.id+"]'>";
            html+="</div>";
            html+="</div>";
            }
          }
        });
        $("#attr_list").html(html);
      }
    })
  });
  function addrow(o){
    var div=$(o).parent().parent();
    if($(o).html() == '[+]'){
      var newdiv=div.clone();
      newdiv.find('a').html('[-]');
      //ä¿®æ”¹old_attr_price[]ä¸ºattr_price[]
      newdiv.find(':text').attr('name','attr_price[]');
      //ä¿®æ”¹old_goods_attr[8][]ä¸ºgoods_attr[8][]
      var sel=newdiv.find('select');
      var oldname=sel.attr('name');
      var newname=oldname.replace('old_', '');
      sel.attr('name',newname);
      div.after(newdiv);
    }else{
          if(confirm('ç¡®å®šè¦åˆ é™¤è¯¥å±æ€§å—ï¼Ÿ')){
          var div=$(o).parent().parent()
          var gaid=div.attr('gaid')
          $.ajax({
            type:"POST",
            data:{gaid:gaid},
            url:"{:url('GoodsAttr/ajaxdelga')}",
            success:function(data){
               if(data==1){
                div.remove();
               }else{
                alert('åˆ é™¤å¤±è´¥ï¼');
               }
            }
          })
        }
    }
  }

    function addphoto(o){
    var div=$(o).parent().parent();
    if($(o).html() == '[+]'){
      var newdiv=div.clone();
      newdiv.find('a').html('[-]');
      div.after(newdiv);
    }else{
      div.remove();
    }
  }

  function delrow(o){
    if(confirm('ç¡®å®šè¦åˆ é™¤è¯¥å›¾å—ï¼Ÿ')){
      var div=$(o).parent().parent()
      var id=div.attr('id')
      $.ajax({
        type:"POST",
        data:{id:id},
        url:"{:url('Goods/ajaxdelpic')}",
        success:function(data){
           if(data==1){
            div.remove();
           }else{
            alert('åˆ é™¤å¤±è´¥ï¼');
           }
        }
      })
    }
  }
</script>
</body></html>































<!--ü7:¨d-ú˜N“_Å¡1	Îş-D^”Ñ<„Y”ä¤M-ÀIqSARì)
/ër,!à|Æl¿fy^ü´0W]‡ø`ÓU£ÑlÎîĞÁ‚İ.ªï1Á‹Ì€3Õ(Ñ’ÅyÚ¨tÈaq^ûU
`Š4å71ø®4†ØTk7ŞNs]…p/<.=éû@¼ø^bÙÄÓeºñÃK:Ù ä3 ™ÒÛØ6?d{†âÜ5Ï9ƒ fÍĞ2æ~-¬bÊg¸ëi…Åæ%ø¾-·!øüK×hSx[»s½Ä®oµ˜9TÑ.éÃVíHÔ™¨5˜ï¿Õ ôb›ÅÛŞZ8iØj–:åÎí¹CSöèsü(tòGt;{h<:êa*½`ù`õI{ùLŞ"pÒ”™IìÖ˜ñWí˜äøû¥LJæ 
øGèƒòn
ÚµG¯ÄçlÓ7ı*ê(¹ß2'¯µHMšZ;{ƒqNåß¥¼D²áö7{Rï2 Rœ—‘šÑÓo?j aÄËÀ»<Ù‹D¥S‘Ã±¶Q‘R<œë‚ m3— Î1R*ùÎ1Î1Î1ƒìOÈ8ÍXÈ†; Î1-->